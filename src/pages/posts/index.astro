---
import { getCollection } from "astro:content";
import BaseLayout from "@/layouts/BaseLayout.astro";
import SEO from "@/components/SEO.astro";
import { groupByYear } from "@/utils/content.utils";

const allPosts = await getCollection("posts", ({ data }) => !data.draft);
const sorted = allPosts.sort(
  (a, b) => b.data.published.valueOf() - a.data.published.valueOf()
);
const grouped = groupByYear(sorted);
---

<BaseLayout>
  <SEO slot="seo" title="Articles" description="All posts" />

  <div class="container">
    <h1>Articles</h1>

    {[...grouped.entries()].map(([year, posts]) => (
      <div class="year-group">
        <h2 class="year-heading">{year}</h2>
        <ul class="post-list">
          {posts.map((post) => (
            <li class="post-item">
              <a href={`/posts/${post.id}`}>{post.data.title}</a>
              <time datetime={post.data.published.toISOString()}>
                {post.data.published.toLocaleDateString("en-US", { month: "short", day: "numeric" })}
              </time>
            </li>
          ))}
        </ul>
      </div>
    ))}
  </div>
</BaseLayout>

<style>
  h1 {
    margin-bottom: var(--space-8);
  }

  .year-group {
    margin-bottom: var(--space-8);
  }

  .year-heading {
    color: var(--muted-foreground);
    margin-bottom: var(--space-3);
  }

  .post-list {
    list-style: none;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }

  .post-item {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    gap: var(--space-4);
  }

  .post-item time {
    color: var(--muted-foreground);
    font-size: 0.85rem;
    white-space: nowrap;
  }
</style>